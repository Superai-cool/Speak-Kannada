<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard | Speak Kannada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      font-family: 'Segoe UI', sans-serif;
      box-sizing: border-box;
    }
    body {
      background-color: #f5f7fa;
    }
    .reply-box {
      background: #fff;
      padding: 15px;
      border-left: 4px solid #6366f1;
      border-radius: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="bg-indigo-700 text-white px-6 py-4 flex justify-between items-center">
    <div class="text-lg font-bold">üó£Ô∏è Speak Kannada ‚Äì Learn with AI</div>
    <div>
      {{ name }} | Credit: {{ credit }}
      <a href="/logout" class="ml-4 underline">Logout</a>
    </div>
  </div>

  <div class="max-w-3xl mx-auto p-6">
    <!-- App Intro -->
    <div class="bg-yellow-100 p-4 rounded-lg text-gray-800 text-sm mb-4">
      üëã Welcome to Speak Kannada! This app helps you translate daily English questions into Kannada with proper pronunciation and usage examples. Ask in English and get your answer instantly.
    </div>

    <!-- Chat Display -->
    <div id="chat-box"></div>

    <!-- User Input Form -->
    <form id="chat-form" class="mt-6">
      <input type="text" id="user-input" name="user_input" placeholder="Type your question in English..." class="w-full p-3 border rounded-lg" required />
      <button type="submit" class="mt-2 px-5 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Send</button>
    </form>
  </div>

  <script>
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const question = input.value.trim();
      if (!question) return;

      // English check (basic)
      if (!/^[A-Za-z0-9.,?'\"\\s]+$/.test(question)) {
        alert("‚ùå Please ask your question in English only.");
        return;
      }

      const userHtml = `<div class='text-right my-3'><div class='inline-block bg-blue-100 text-gray-800 px-4 py-2 rounded-xl'>${question}</div></div>`;
      chatBox.insertAdjacentHTML('beforeend', userHtml);
      input.value = '';

      const loader = document.createElement('div');
      loader.className = 'reply-box';
      loader.innerHTML = '‚è≥ Generating response...';
      chatBox.appendChild(loader);

      const res = await fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_input: question })
      });

      const data = await res.json();
      loader.remove();

      if (res.status !== 200) {
        chatBox.insertAdjacentHTML('beforeend', `<div class='reply-box text-red-600'>${data.error || 'Something went wrong.'}</div>`);
        return;
      }

      chatBox.insertAdjacentHTML('beforeend', `<div class='reply-box'>${data.response}</div>`);
    });
  </script>
</body>
</html>
